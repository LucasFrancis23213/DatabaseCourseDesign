# 用户注册

## 数据库表

- AuthInfo(用户认证信息表)
  - **用户ID** (UserID): 关联的用户ID，外键，关联到Users表的UserID。系统指定
  - **认证状态** (AuthStatus): 当前的认证状态，如已验证、待验证等。系统认定
  - **认证日期** (AuthDate): 认证完成的日期。系统认定
  - **VIP等级**(VIPLevel): 关联用户的VIP等级，外键，关联到VipMembers表的VIPLevel。
  - **VIP状态**(Status): 关联用户的VIP认证状态，外键，关联到VIPMembers表的Status。

- Users(用户表)
  - **用户ID** (UserID): 主键，唯一标识每个用户。
  - **用户名** (Username): 用户的名称。
  - **联系方式** (Contact): 用户的联系方式。
  - **VIP等级**(VIPLevel): 关联用户的VIP等级，外键，关联到VipMembers表的VIPLevel。
  - **VIP状态**(Status): 关联用户的VIP认证状态，外键，关联到VIPMembers表的Status。

## UI设计

* 登录界面
  ![登录界面](.\assets\登录界面.png)
  
  
  
* 注册界面及认证界面
  ![注册及认证界面](.\assets\注册及认证界面.png)
  
  ![注册成功界面](.\assets\注册成功.png)
  
  
  
* 关联界面
  
  1. VIP界面
  
  2. 个人信息界面
  
     ![用户信息界面](.\assets\用户信息界面.png)
  
     * 注销界面
  
       ![注销界面](.\assets\注销界面.png)



## E-R图



![用户注册E-R图](.\assets\用户注册E-R图.png)





# 用户管理

## 表

### 通知记录表(NotigicationLogs)

| 标签     | 变量类型    | 说明                                          |
| -------- | ----------- | --------------------------------------------- |
| 通知ID   | int         | 唯一标识每个通知的主键。                      |
| 用户ID   | int         | 要通知的用户ID，外键，关联到Users表的UserID。 |
| 通知类型 | varchar(50) | 通知的类型，如“物品匹配通知”、“系统通知”等。  |
| 发送日期 | DATE        | 通知发送的日期和时间。                        |
| 状态     | varchar(20) | 通知的状态，如已读、未读。                    |

### 用户行为日志表(UserActivityLogs)

| 标签       | 变量类型    | 说明                                              |
| ---------- | ----------- | ------------------------------------------------- |
| 行为日志ID | int         | 唯一标识每条用户行为记录的主键。                  |
| 用户ID     | int         | 行为发起者的用户ID，外键，关联到Users表的UserID。 |
| 行为类型   | varchar(50) | 用户行为的类型，如“登录”、“发布物品”、“评论”等。  |
| 发生时间   | DATE        | 行为发生的具体时间。                              |

### 推荐系统日志表(RecommendationLogs)

| 标签     | 变量类型    | 说明                                            |
| -------- | ----------- | ----------------------------------------------- |
| 日志ID   | int         | 唯一标识每条推荐日志记录的主键。                |
| 用户ID   | int         | 接受推荐的用户ID，外键，关联到Users表的UserID。 |
| 推荐类别 | varchar(50) | 推荐的类型。                                    |
| 推荐时间 | DATE        | 推荐发生的时间。                                |
| 用户反馈 | varchar(20) | 用户对推荐内容的反馈，如“有用”、“无用”。        |

### 交易记录表(TransactionLogs)

| 标签                                | 变量类型      | 说明                                                         |
| ----------------------------------- | ------------- | ------------------------------------------------------------ |
| TransactionID (交易ID)              | int           | 主键，唯一标识每笔交易。                                     |
| FromUserID (发起方用户ID)           | int           | 发起交易的用户ID，外键，关联到Users表。                      |
| ToUserID (接收方用户ID)             | int           | 接收交易的用户ID，外键，关联到Users表。对于系统收费等情况，此字段可能为空或指向一个特定的系统账户。 |
| ItemID (物品ID)                     | int           | 交易相关的物品ID，外键，关联到LostItems或FoundItems表。这个字段在某些记录中可能为空。 |
| Amount (金额)                       | decimal(10,2) | 交易金额。根据交易的性质，这可以是正数（如支付赏金、购买服务）。 |
| TransactionType (交易类型)          | varchar(50)   | 描述交易类型的字符串，如"赏金支付"、"服务购买"、"退款"等。   |
| Status (状态)                       | varchar(20)   | 交易的当前状态，如"进行中"、"完成"、"失败"等。               |
| TransactionBeginDate (交易开始日期) | TIMESTAMP     | 记录交易开始的时间(交易发起，类比淘宝用户付完钱等待收货的状态)。 |
| TransactionEndDate (交易完成日期)   | TIMESTAMP     | 记录交易完成的时间(交易结束，可能是用户点击确认收获后对应的记录)。 |
| Description (描述)                  | varchar(255)  | 关于交易的额外信息或备注，例如交易的具体目的或原因。         |

------

**注意**： 此处的变量类型为最基本的说明，实际情况需要根据Oracle数据库的特性进行修改。

------

## E-R图设计说明及讨论

### 实体

- 用户(Users)
  - UserID (主键)
  - 其他用户属性如用户名、电子邮件等
- 通知记录(NotificationLogs)
  - NotificationID (主键)
  - UserID (外键)
  - NotificationType
  - SentDate
  - Status
- 用户行为日志(UserActivityLogs)
  - ActivityLogID (主键)
  - UserID (外键)
  - ActivityType
  - Timestamp
- 交易(Transaction)
  - TransactionID (主键)
  - FromUserID (外键)
  - ToUserID (外键)
  - ItemID (外键)
  - Amount
  - TransactionType
  - Status
  - TransactionBeginDate
  - TransactionEndDate
  - Description

### 关系

- 用户(User)与通知记录(NotificationLogs)之间是一对多关系，一个用户可以有多条通知记录，但每条通知记录只属于一个用户。
- 用户(User)与用户行为日志(UserActivityLogs)之间也是一对多关系，一个用户可以有多条行为日志，但每条行为日志只属于一个用户。
- 交易(Transaction)表中的FromUserID和ToUserID与用户(User)表的UserID存在一对多关系，即一个交易中包含一个发起者和一个接收者，但一个用户可以发起多个交易或接收多个交易。
- 交易(Transaction)与物品(Item)之间可能存在一对一或一对多的关系，表示交易涉及的物品。

关系一定会有遗漏的。需要继续讨论。

同样，关系一定会有不符合已有的表的，需要继续讨论。



# 安全维护
## 相关安全问题的讨论
### 韩敬霄组
VIP和广告功能
> 无需新表补充，充值的接口安全问题  

用户发表评论
> 存在用户恶意删屏导致评论表数据过量，已经与该功能相关同学讨论后续功能设计时注意

### 陆诚彬组
已经加入一个过渡表来改善安全问题

### 朱雨凝组
无新表加入，但有几个问题需要讨论解决：  
1. 不同用户间用户名相同、密码相同的情况，可能会造成混淆。  
2. 用户的联系方式和认证状态等敏感信息的授权访问。
3. 认证状态和认证信息在首次认证过程中存在被不当修改或者绕过的风险。
4. 当前的数据表设计仅记录用户的认证状态，不记录具体实名认证的内容，不便于审核和回溯，也可能被复用。但鉴于我们现在只做实名认证的效果，不记录具体内容也有利于保护信息，是否要考虑这个问题？

## 拟定表

### SystemLogs(系统日志表)  

| 标签                        | 变量类型      | 说明                                               |
| --------------------------- | ------------- | -------------------------------------------------- |
| 日志ID (LogID)              | INT 或 BIGINT | 通常使用自增主键，确保每条记录唯一                 |
| 操作类型 (OperationType)    | VARCHAR(50)   | 存储文本描述的操作类型，如“系统维护”、“数据备份”等 |
| 操作详情 (OperationDetails) | TEXT          | 存储操作的具体详情，这可能是一个较长的文本         |
| 操作用户ID (UserID)         | DATETIME      | 存储操作发生的日期和时间                           |


### APIAccessLogs (API访问日志表)

| 标签                    | 变量类型      | 说明                                                         |
| ----------------------- | ------------- | ------------------------------------------------------------ |
| 访问ID (AccessID)       | INT 或 BIGINT | 作为主键使用，通常设为自增，以保证唯一性                     |
| API名称 (APIName)       | VARCHAR(100)  | 存储被访问API的名称或唯一标识。                              |
| 访问者标识 (AccessorID) | varchar(50)   | 存储访问者的用户ID或第三方应用ID。若访问者可以是多种类型实体，此字段需要适当设计以适配这种多态性 |
| 访问时间 (AccessTime)   | DATETIME      | 行为发生的具体时间。                                         |
| 访问结果 (AccessResult) | VARCHAR(50)   | 存储API访问的结果，如“成功”、“失败”或具体的错误代码          |
### SecurityEvents (安全事件记录表)

| 标签                      | 变量类型      | 说明                                                         |
| ------------------------- | ------------- | ------------------------------------------------------------ |
| 事件ID (EventID)          | INT 或 BIGINT | 作为表的主键，通常设为自增，保证每个安全事件具有唯一标识     |
| 事件类型 (EventType)      | VARCHAR(100)  | 描述安全事件的类型，例如“账户异常登录”、“数据泄露”等         |
| 事件详情 (EventDetails)   | TEXT          | 提供关于安全事件的详细信息，包括事件的具体描述、可能涉及的系统组件、影响范围等 |
| 处理状态 (Status)         | VARCHAR(50)   | 表示事件的当前处理状态，例如“已解决”、“待处理”等             |
| 发生日期 (OccurrenceDate) | DATE          | 事件发生的日期                                               |
### 审核过渡表

| 标签                      | 变量类型      | 说明                                                 |
| ------------------------- | ------------- | ---------------------------------------------------- |
| 临时ID (TempItemID)       | INT 或 BIGINT | 主键，系统自动生成，唯一标识每条记录                 |
| 物品ID (ItemID)           | INT 或 BIGINT | 关联的正式物品ID，为空表示新提交的物品               |
| 物品名称 (ItemName)       | VARCHAR(255)  | 用户输入的物品名称                                   |
| 类别ID (CategoryID)       | INT           | 用户选择的类别ID，关联到ItemCategories表             |
| 描述 (Description)        | TEXT          | 用户输入的描述信息                                   |
| 地点 (Location)           | VARCHAR(255)  | 用户输入的地点（遗失地点或找回地点）                 |
| 日期 (Date)               | DATE          | 用户输入的日期（遗失日期或找回日期）                 |
| 用户ID (UserID)           | INT 或 BIGINT | 提交信息的用户ID，关联到Users表                      |
| 图片URL (ImageURL)        | VARCHAR(255)  | 用户上传的图片URL                                    |
| 审核状态 (Status)         | VARCHAR(50)   | 物品的审核状态，如“待审核”、“审核通过”、“审核拒绝”等 |
| 处理类型 (ProcessType)    | VARCHAR(50)   | 标识是“遗失物品”还是“找回物品”                       |
| 提交日期 (SubmissionDate) | DATETIME      | 系统自动生成的提交日期                               |
| 审核备注 (ReviewComments) | TEXT          | 用于记录审核过程中的任何特别说明或问题               |

## E-R图设计相关说明
### SystemLogs (系统日志表)

- **实体**: SystemLogs
- **属性**:
  - LogID
  - OperationType
  - OperationDetails
  - UserID
  - OperationDate
- **关系**:
  - 关联到 Users 表 (通过 UserID)，记录用户的操作。

### APIAccessLogs (API访问日志表)

- **实体**: APIAccessLogs
- **属性**:
  - AccessID
  - APIName
  - AccessorID
  - AccessTime
  - AccessResult
- **关系**:
  - 关联到 Users 表或第三方应用表（如果存在），通过 AccessorID 标识访问者，关联到API调用接口。

### SecurityEvents (安全事件记录表)

- **实体**: SecurityEvents
- **属性**:
  - EventID
  - EventType
  - EventDetails
  - Status
  - OccurrenceDate
- **关系**:
  - 无直接的外键关系，但可以与用户表间接关联，涉及到用户安全事件（与其他同学设计的功能方面的安全问题输出关联）。

### 审核过渡表

- **实体**: AuditTransition
- **属性**:
  - TempItemID
  - ItemID
  - ItemName
  - CategoryID
  - Description
  - Location
  - Date
  - UserID
  - ImageURL
  - Status
  - ProcessType
  - SubmissionDate
  - ReviewComments
- **关系**:
  - 关联到 Users 表 (通过 UserID)
  - 关联到 ItemCategories 表 (通过 CategoryID)
  - ItemID 可以为空，表示新提交的物品

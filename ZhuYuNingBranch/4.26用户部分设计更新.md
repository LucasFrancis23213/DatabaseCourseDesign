# 4.26用户部分设计更新

by ZYN DPY

## 用户注册

### 1.前端元素

* 登录界面，包括
  1. 用户名
  2. 密码
  3. 验证码（？）
* 注册界面，包括
  1. 自定义用户名
  2. 自定义密码栏
  3. 确认密码栏
  4. 实名认证栏
* 认证界面，包括
  1. 姓名
  2. 身份证号
* 注销界面，包括
  1. 用户名
  2. 密码
  3. 确认注销按钮
  4. 确认注销信息提示
* 关联界面
  1. VIP界面
  2. 个人信息界面，包括
     1. 头像（？）
     2. 用户名
     3. 用户ID
     4. VIP等级信息
     5. 是否实名认证

### 2.流程图

在表AuthInfo中补充了与表VIPMembers关联的元素：VIPLevel和Status

![用户注册](.\用户注册.jpg)



### 3.新出现的问题

* 若只有实名认证一种认证方式，是否保留AuthMethod？
* 删除AuthID后AuthInfo没有PK
* 登录界面是否需要验证码？
* 个人主页是否需要显示头像？（若添加可能需要加上更多表或元素）



## 用户管理

### 说明

#### 流程图

这部分都是触发机制或定期执行的，无流程图。使用可能关联的表代替。

在这部分同时完成前端需要元素及相关触发机制的说明。

***

待定：触发方式选择：前端？修改表后的 trigger ？

- **前端**
  - 优点：
    - 较为灵活（带来操作不规范的问题）
    - 不受表的限制
    - 可以完成所有的内容

  - 缺点：
    - 如何实现原子级操作？
    - 如何实现数据库的同步？
  
- trigger
  - 优点：
    - 容易实现原子级操作
    - 保证数据库的同步

  - 缺点：
    - 对 trigger 的使用不熟练
    - 有些内容可能无法由 trigger 实现（也可能是没有了解高级功能）
    - 受限于表的修改查询等，不灵活
    - 需要良好设计，有的操作可能设计多个表的更改，但是只应该记录一次

性能问题完全不了解

#### 1. NotificationLogs

发送通知可以由 table 的修改表示，但是如何用 table 表示用户点开通知？

触发机制：系统发送通知、用户点击或关闭通知

1. 发送通知（需要提供 通知ID（自己生成？不建议），用户ID，通知类型，发送时间）
2. 用户对通知操作（需要提供 通知ID， 用户ID）

#### 2. UserActivityLogs

有些内容只能由前端完成，例如用户登录。有些内容可以由数据库更改触发，关联的表如下：

AuthInfo  UserPreferences  UserRatings  (UserPoints)  UserMessages  UserRelationships

UserSubscriptions  LostItems  FoundItems  ItemComments  ItemClaimProcesses

UserFeedback  RewardOffers  ItemExchanges  ItemReturnAgreements  

SocialMediaShares  UserFeeds  QnA  FollowLists  

触发机制：用户所有操作成功(如何判断成功？)

需要信息：（理想为前端每个按钮都绑定一条信息，作为`行为类型`），发生时间，用户ID，（行为ID）

#### 3. DataAnalysisReports

定期生成？用户点击时生成？
需要访问UserActivityLogs

#### 4. RecommendationLogs

与通知相同

#### 5. TransactionLogs

建议由审核人员审核后触发

需要信息：所有信息

另外建议：只记录完成的交易，建新表记录未完成交易？

### 具体表设计

- 通知记录表 (NotificationLogs)
  - **通知ID** (NotificationID): 唯一标识每个通知的主键。
  - **用户ID** (UserID): 要通知的用户ID，外键，关联到Users表的UserID。
  - **通知类型** (NotificationType): 通知的类型，如“物品匹配通知”、“系统通知”等。
  - **发送日期** (SentDate): 通知发送的日期和时间。
  - **状态** (Status): 通知的状态，如已读、未读。

- 用户行为日志表 (UserActivityLogs)：通过记录用户的每一次活动，帮助管理员更好地理解用户行为，优化用户体验。
  - **行为日志ID** (ActivityLogID): 唯一标识每条用户行为记录的主键。
  - **用户ID** (UserID): 行为发起者的用户ID，外键，关联到Users表的UserID。
  - **行为类型** (ActivityType): 用户行为的类型，如“登录”、“发布物品”、“评论”等。
  ~~- **行为详情** (ActivityDetails): 行为的详细描述。~~（拟弃用，4.26日）
  - **发生时间** (Timestamp): 行为发生的具体时间。

- 数据分析报表 (DataAnalysisReports)：定期生成各种数据分析报表，帮助管理员了解平台运营状况，指导决策。
  - **报表ID** (ReportID): 唯一标识每个报表记录的主键。
  - **用户ID** (UserID): 报表对应的用户。(拟更改，4.26日，添加用户ID)
  - **报表类型** (ReportType): 报表的类型，如“用户活跃度分析”、“物品找回率统计”等。
  - **报表数据** (ReportData): 报表的具体数据内容，可能包含文字、数字或图表等。
  - **生成日期** (GenerationDate): 报表生成的日期。

- 推荐系统日志表 (RecommendationLogs)
  - **日志ID** (LogID): 唯一标识每条推荐日志记录的主键。
  - **用户ID** (UserID): 接受推荐的用户ID，外键，关联到Users表的UserID。
  - **推荐类别** (RecommendedContent): 推荐的类型。(拟更改，4.26日，改为推荐类别)
  - **推荐时间** (RecommendationTime): 推荐发生的时间。
  - **用户反馈** (UserFeedback): 用户对推荐内容的反馈，如“有用”、“无用”。
  
- 交易记录表 (TransactionLogs)
  - **TransactionID** (交易ID): 主键，唯一标识每笔交易。
  - **FromUserID** (发起方用户ID): 发起交易的用户ID，外键，关联到**Users**表。
  - **ToUserID** (接收方用户ID): 接收交易的用户ID（如果适用），外键，关联到**Users**表。对于系统收费等情况，此字段可能为空或指向一个特定的系统账户。
  - **ItemID** (物品ID): 交易相关的物品ID（如果适用），外键，关联到**LostItems**或**FoundItems**表。不是所有交易都与物品直接相关，因此，这个字段在某些记录中可能为空。
  - **Amount** (金额): 交易金额。（拟更改，4.26日，取消负数）
  - **TransactionType** (交易类型): 描述交易类型的字符串，如"赏金支付"、"服务购买"、"退款"等。
  - **Status** (状态): 交易的当前状态，如"进行中"、"完成"、"失败"等。
  ~~- **TransactionDate** (交易日期): 记录交易发生的日期和时间。~~(拟弃用，4.26日)
  - **TransactionBeginDate** (交易开始日期): 记录交易开始的时间(交易发起，类比淘宝用户付完钱等待收货的状态)。(拟更改，4.26日，改为开始和完成时间)
  - **TransactionEndDate** (交易完成日期): 记录交易完成的时间(交易结束，可能是用户点击确认收获后对应的记录)。(拟更改，4.26日)
  - **Description** (描述): 关于交易的额外信息或备注，例如交易的具体目的或原因。

### 新问题

1. 各个Log的ID如何获取？如果将来查询时无法通过此ID获取信息，此条目作用？
2. 每个交易都会被 UserActivityLogs 和 TransactionLogs 记录，它们之间的 ID 关联？此时 UserActivityLogs 的时间如何记录？或者将其拆分成多个行为？
3. 重复问题？例如2和推荐与通知

